<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Player</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; }
        #status { margin: 20px; font-weight: bold; padding: 10px; border-radius: 5px; }
        .loading { background: #fff3cd; color: #856404; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h3>Flashæ¸¸æˆæ’­æ”¾å™¨ (CORBé—®é¢˜ä¿®å¤ç‰ˆ)</h3>
    <div id="status" class="loading">çŠ¶æ€ï¼šå‡†å¤‡åŠ è½½Ruffleåº“...</div>
    <ruffle-player id="gamePlayer" width="800" height="600">
        <a href="d1.swf"></a>
    </ruffle-player>

    <script>
        const statusEl = document.getElementById('status');
        const playerEl = document.getElementById('gamePlayer');
        let ruffleLoaded = false;

        // ç­–ç•¥1ï¼šæ£€æµ‹Ruffleè„šæœ¬æ˜¯å¦æˆåŠŸåŠ è½½
        function checkScriptLoaded() {
            if (window.RufflePlayer) {
                ruffleLoaded = true;
                statusEl.textContent = 'çŠ¶æ€ï¼šâœ… Ruffleåº“åŠ è½½æˆåŠŸï¼Œæ­£åœ¨åˆå§‹åŒ–æ’­æ”¾å™¨...';
                statusEl.className = 'loading';
                initializePlayer();
            } else {
                statusEl.textContent = 'çŠ¶æ€ï¼šâŒ ä¸»è¦CDNåŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æº...';
                statusEl.className = 'error';
                loadFallbackScript(); // å¯åŠ¨å¤‡ç”¨æ–¹æ¡ˆ
            }
        }

        // ç­–ç•¥2ï¼šå¤‡ç”¨æ–¹æ¡ˆ - åŠ è½½å¦ä¸€ä¸ªæºçš„Ruffle
        function loadFallbackScript() {
            const fallbackScript = document.createElement('script');
            // å°è¯•ä»Ruffleå®˜æ–¹åŸŸååŠ è½½ï¼ˆå¯èƒ½è§„é¿CORBï¼‰
            fallbackScript.src = 'https://ruffle.rs/ruffle.js';
            fallbackScript.onload = function() {
                statusEl.textContent = 'çŠ¶æ€ï¼šâš ï¸ å¤‡ç”¨æºåŠ è½½æˆåŠŸï¼Œæ­£åœ¨åˆå§‹åŒ–...';
                statusEl.className = 'loading';
                ruffleLoaded = true;
                initializePlayer();
            };
            fallbackScript.onerror = function() {
                statusEl.innerHTML = 'çŠ¶æ€ï¼šâŒ æ‰€æœ‰æ¥æºå‡è¢«é˜»æ­¢ã€‚<br><strong>æ ¹æœ¬åŸå› ï¼šæ‚¨çš„æµè§ˆå™¨å®‰å…¨ç­–ç•¥ï¼ˆCORBï¼‰è¿‡äºä¸¥æ ¼ï¼Œå·²é˜»æ­¢åŠ è½½å¿…è¦çš„æ¸¸æˆå¼•æ“ã€‚</strong><br>è¯·å°è¯•ï¼š1. æ›´æ¢æµè§ˆå™¨ï¼ˆå¦‚Chromeï¼‰ï¼›2. åœ¨ç”µè„‘ä¸Šè®¿é—®ã€‚';
                statusEl.className = 'error';
            };
            document.head.appendChild(fallbackScript);
        }

        // åˆå§‹åŒ–æ’­æ”¾å™¨
        function initializePlayer() {
            let attempts = 0;
            const maxAttempts = 20; // å¢åŠ å°è¯•æ¬¡æ•°

            function checkPlayer() {
                attempts++;
                if (playerEl.shadowRoot) {
                    statusEl.textContent = 'çŠ¶æ€ï¼šğŸ‰ æˆåŠŸï¼Flashæ¸¸æˆæ­£åœ¨è¿è¡Œã€‚';
                    statusEl.className = 'success';
                    return;
                }
                if (attempts < maxAttempts) {
                    setTimeout(checkPlayer, 300);
                } else {
                    statusEl.innerHTML = 'çŠ¶æ€ï¼šâŒ æ’­æ”¾å™¨åˆå§‹åŒ–è¶…æ—¶ã€‚<br>Ruffleåº“å·²åŠ è½½ï¼Œä½†æ— æ³•å¯åŠ¨å¼•æ“ã€‚<br>è¿™é€šå¸¸æ˜¯<b>è®¾å¤‡æµè§ˆå™¨å†…æ ¸è¿‡æ—§</b>å¯¼è‡´ï¼Œå»ºè®®ä½¿ç”¨ç”µè„‘Chrome/Edgeæµè§ˆå™¨æµ‹è¯•ã€‚';
                    statusEl.className = 'error';
                }
            }
            setTimeout(checkPlayer, 100);
        }

        // ä¸»æ‰§è¡Œé€»è¾‘
        statusEl.textContent = 'çŠ¶æ€ï¼šæ­£åœ¨ä»CDNåŠ è½½Ruffleåº“...';
        // åˆ›å»ºå¹¶ç›‘æ§ä¸»è¦çš„Ruffleè„šæœ¬æ ‡ç­¾
        const mainScript = document.createElement('script');
        mainScript.src = 'https://cdn.jsdelivr.net/npm/@ruffle-rs/ruffle';
        mainScript.onload = checkScriptLoaded;
        mainScript.onerror = function() {
            // å¦‚æœç›´æ¥åŠ è½½å¤±è´¥ï¼Œä¹Ÿè§¦å‘å¤‡ç”¨æ–¹æ¡ˆ
            statusEl.textContent = 'çŠ¶æ€ï¼šâŒ ç½‘ç»œè¯·æ±‚è¢«é˜»æ­¢ï¼Œå¯åŠ¨å¤‡ç”¨æ–¹æ¡ˆ...';
            loadFallbackScript();
        };
        document.head.appendChild(mainScript);
    </script>
</body>
</html>
