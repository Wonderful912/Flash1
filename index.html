<!DOCTYPE html>
<html>
<head>
    <title>Ruffleç»ˆæè¯Šæ–­</title>
    <script>
        // è¯Šæ–­æ—¥å¿—
        window.RUFFLE_LOG = [];
        function log(step, message) {
            const msg = `[${step}] ${message}`;
            window.RUFFLE_LOG.push(msg);
            console.log(msg);
            document.getElementById('log').innerHTML += msg + '<br>';
        }
    </script>
    <!-- ä½¿ç”¨æœ€ç¨³å®šçš„CDNï¼Œå¹¶ç›‘å¬åŠ è½½äº‹ä»¶ -->
    <script src="https://cdn.jsdelivr.net/npm/@ruffle-rs/ruffle@2024.10.14"
            onload="log('è„šæœ¬', 'Ruffle JSåº“åŠ è½½æˆåŠŸ')"
            onerror="log('è„šæœ¬', 'âŒ Ruffle JSåº“åŠ è½½å¤±è´¥')">
    </script>
</head>
<body>
    <h3>Ruffleåˆå§‹åŒ–è¯Šæ–­</h3>
    <div id="log" style="font-family:monospace; background:#eee; padding:10px;"></div>
    <hr>
    <ruffle-player id="player" width="800" height="600">
        <a href="d1.swf"></a>
    </ruffle-player>
    <script>
        log('å¼€å§‹', 'è¯Šæ–­å¼€å§‹...');
        let checks = 0;
        const maxChecks = 30; // æ£€æŸ¥30æ¬¡ï¼Œå…±15ç§’

        function diagnose() {
            checks++;
            const player = document.getElementById('player');
            // æ£€æŸ¥1ï¼šå…¨å±€å¯¹è±¡
            if (!window.RufflePlayer) {
                log('æ£€æŸ¥' + checks, 'ç­‰å¾…Ruffleå…¨å±€å¯¹è±¡...');
            } else {
                log('æ£€æŸ¥' + checks, 'âœ… Ruffleå…¨å±€å¯¹è±¡å·²æ‰¾åˆ°');
                // æ£€æŸ¥2ï¼šWASMå¼•æ“ï¼ˆé€šè¿‡æ¨¡æ‹Ÿå‡½æ•°åæ¨æ–­ï¼‰
                if (window.RufflePlayer.load) {
                    log('æ£€æŸ¥' + checks, 'âœ… Ruffleå¼•æ“æ–¹æ³•å·²å°±ç»ª');
                }
            }
            // æ£€æŸ¥3ï¼šæ’­æ”¾å™¨æŒ‚è½½ï¼ˆæ ¸å¿ƒï¼‰
            if (player && player.shadowRoot) {
                log('æ£€æŸ¥' + checks, 'ğŸ‰ æˆåŠŸï¼Ruffleå·²æŒ‚è½½å¹¶æ¥ç®¡æ’­æ”¾å™¨ã€‚');
                return;
            }
            if (checks < maxChecks) {
                setTimeout(diagnose, 500); // æ¯åŠç§’æ£€æŸ¥ä¸€æ¬¡
            } else {
                log('è¶…æ—¶', 'âŒ è¯Šæ–­è¶…æ—¶ã€‚Ruffleå¼•æ“æœªèƒ½å¯åŠ¨æˆ–æŒ‚è½½ã€‚');
                log('ç»“è®º', 'é—®é¢˜å®šä½ï¼šæµè§ˆå™¨ç¯å¢ƒï¼ˆç³»ç»Ÿ/é©±åŠ¨ï¼‰æ— æ³•æ‰§è¡ŒRuffleçš„WebAssemblyæ ¸å¿ƒã€‚');
            }
        }
        setTimeout(diagnose, 1000); // ç»™é¡µé¢1ç§’åŠ è½½æ—¶é—´
    </script>
</body>
</html>
